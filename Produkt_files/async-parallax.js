!function(t,i){"object"==typeof exports?module.exports=i(require("./util"),require("./events"),require("solidpixels/cdn/publish-subscribe")):("object"!=typeof t.Solidpixels&&(t.Solidpixels={}),t.Solidpixels.Parallax=i(t.Util,t.Events,t.Solidpixels.PublishSubscribe))}(this,function(t,i,e){let s={},o=function(e,s){this.animated=!1,this.lastScrollY=0,this.ticking=!1,this.element=e,this.wrapper=e.closest(".section"),this.options=s,this.listeners={scroll:null,resize:null},this.lastSizes={wrapper:{width:0,height:0},window:{width:window.innerWidth,height:window.innerHeight}};let o=this.element.getAttribute("data-parallax-speed");o&&(this.options.speedDivider=parseInt(o,10)),this.offset=t.offset(this.wrapper).top,this.options.maxScroll=this.getMaxScroll(),this.options.minScroll=this.getMinScroll(),this.listeners.scroll=t.throttle(this.handleScroll.bind(this),15),this.listeners.resize=t.throttle(this.handleUpdate.bind(this),100),i.on("scroll",window,this.listeners.scroll),i.on("resize",window,this.listeners.resize),this.handleInit()};return o.DEFAULTS={speedDivider:4,maxScroll:0,minScroll:0,continuous:!0,scrollOffset:100},o.prototype.getMaxScroll=function(){return this.offset+this.wrapper.offsetHeight+this.options.scrollOffset},o.prototype.getMinScroll=function(){let t=window.innerHeight;return this.options.continuous?this.offset>t?this.offset-t:0:this.offset>t?this.offset:0},o.prototype.handleInit=function(){this.handleUpdate(),i.fire(window,"resize"),this.element.classList.add("is-parallax-loaded")},o.prototype.handleUpdate=function(){if(this.lastSizes.wrapper.width===this.wrapper.offsetWidth&&this.lastSizes.wrapper.height===this.wrapper.offsetHeight)return!1;this.lastSizes={window:{width:window.innerWidth,height:window.innerHeight},wrapper:{width:this.wrapper.offsetWidth,height:this.wrapper.offsetHeight}};let i=Math.round(window.innerHeight/this.options.speedDivider);return this.element.style.top=-1*i+"px",this.offset=t.offset(this.wrapper).top,this.options.maxScroll=this.getMaxScroll(),this.options.minScroll=this.getMinScroll(),this.handleScroll.call(this)},o.prototype.updatePosition=function(){let t=0;(t=Math.round((t=this.options.continuous?this.lastScrollY+this.lastSizes.window.height-this.offset:this.lastScrollY-this.offset)/this.options.speedDivider))<0&&(t=0),this.translateY(this.element,t),this.ticking=!1},o.prototype.translateY=function(t,e){t.style.transform="translate3d(0px,"+e+"px, 0px)",i.fire(t,"scrolled.parallax.sp",{translate:e})},o.prototype.requestTick=function(){this.ticking||(window.requestAnimationFrame(this.updatePosition.bind(this)),this.ticking=!0)},o.prototype.handleScroll=function(){this.lastScrollY=window.pageYOffset,this.lastScrollY<this.options.maxScroll&&this.lastScrollY>=this.options.minScroll&&this.requestTick.call(this)},o.prototype.destroy=function(){let t=this;i.off("scroll",window,t.listeners.scroll),i.off("resize",window,t.listeners.resize),t.element.style.transform="",t.element.style.top="",t.element.classList.remove("is-parallax-loaded")},o.plugin=function(i,e){let l=t.createArrayCollection(i);for(let i=0,n=l.length;i<n;i+=1){let n=l[i],r=t.getData(n,null,!0),h=t.extend({},o.DEFAULTS,r,"object"==typeof e&&e),a=n.getAttribute("data-uniqid");"string"!=typeof e&&a&&s[a]&&s[a].handleUpdate(),"string"==typeof e&&"destroy"===e&&a&&s[a]&&(s[a].destroy(),delete s[a],n.removeAttribute("data-uniqid")),"string"==typeof e||a||(a=t.uniqId(),n.setAttribute("data-uniqid",a),s[a]=new o(n,h))}},e.subscribe("SLP:Parallax:init",({elements:t,options:i})=>{o.plugin(t,i)}),o});